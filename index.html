<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Typing - Improve Your Typing Skills</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .finger-selector {
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .finger-buttons {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .hand-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hand-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .fingers-visual {
            display: flex;
            gap: 5px;
            align-items: flex-end;
        }

        .keyboard {
            margin: 30px auto;
            padding: 30px;
            background: #2c3e50;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: fit-content;
        }

        .keyboard-row {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        .keyboard-row:nth-child(2) {
            margin-left: 30px;
        }

        .keyboard-row:nth-child(3) {
            margin-left: 45px;
        }

        .keyboard-row:nth-child(4) {
            margin-left: 60px;
        }

        .key {
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3a4e63 0%, #2c3e50 100%);
            border: 2px solid #34495e;
            border-radius: 6px;
            color: #ecf0f1;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            user-select: none;
            position: relative;
        }

        .key:hover {
            background: linear-gradient(135deg, #4a5e73 0%, #3c4e60 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .key.selected {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-color: #d68910;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(243, 156, 18, 0.5);
        }

        .key.space {
            width: 350px;
        }

        .key.tab {
            width: 80px;
        }

        .key.caps {
            width: 90px;
        }

        .key.shift-left {
            width: 105px;
        }

        .key.shift-right {
            width: 120px;
        }

        .key.backspace {
            width: 90px;
        }

        .key.enter {
            width: 100px;
        }

        .key-label {
            font-size: 0.7em;
            position: absolute;
            top: 5px;
            left: 8px;
            opacity: 0.6;
        }

        .key-main {
            font-size: 1.15em;
            margin-top: 10px;
        }

        .key.tab, .key.caps, .key.shift-left, .key.shift-right,
        .key.backspace, .key.enter {
            font-size: 0.85em;
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }

        .key.tab:hover, .key.caps:hover, .key.shift-left:hover,
        .key.shift-right:hover, .key.backspace:hover, .key.enter:hover {
            background: linear-gradient(135deg, #445e75 0%, #3c4e60 100%);
        }

        .key.tab.selected, .key.caps.selected, .key.shift-left.selected,
        .key.shift-right.selected, .key.backspace.selected, .key.enter.selected {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
        }

        .key.home-row {
            position: relative;
        }

        .key.home-row::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: #95a5a6;
            border-radius: 2px;
        }

        .key.home-row.selected::after {
            background: white;
        }

        /* Finger color coding - ONLY when selected */
        .key.selected[data-finger="left-pinky"] {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
            border-color: #c44569;
        }

        .key.selected[data-finger="left-ring"] {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            border-color: #6c5ce7;
        }

        .key.selected[data-finger="left-middle"] {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-color: #0984e3;
        }

        .key.selected[data-finger="left-index"] {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%);
            border-color: #00b894;
        }

        .key.selected[data-finger="right-index"] {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-color: #fdcb6e;
        }

        .key.selected[data-finger="right-middle"] {
            background: linear-gradient(135deg, #fab1a0 0%, #e17055 100%);
            border-color: #e17055;
        }

        .key.selected[data-finger="right-ring"] {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            border-color: #e84393;
        }

        .key.selected[data-finger="right-pinky"] {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            border-color: #6c5ce7;
        }

        .key.selected[data-finger] {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(-3px) scale(1.05);
            filter: brightness(1.2);
        }

        .finger-btn {
            width: 28px;
            border: none;
            border-radius: 14px 14px 4px 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            overflow: visible;
        }

        .finger-visual {
            width: 100%;
            border-radius: 14px 14px 4px 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0;
            transition: all 0.2s;
        }

        .finger-label {
            display: none;
        }

        /* Compact finger heights */
        .finger-btn[data-finger="left-pinky"] .finger-visual,
        .finger-btn[data-finger="right-pinky"] .finger-visual {
            height: 35px;
        }

        .finger-btn[data-finger="left-ring"] .finger-visual,
        .finger-btn[data-finger="right-ring"] .finger-visual {
            height: 45px;
        }

        .finger-btn[data-finger="left-middle"] .finger-visual,
        .finger-btn[data-finger="right-middle"] .finger-visual {
            height: 50px;
        }

        .finger-btn[data-finger="left-index"] .finger-visual,
        .finger-btn[data-finger="right-index"] .finger-visual {
            height: 42px;
        }

        /* Finger colors */
        .finger-btn[data-finger="left-pinky"] .finger-visual {
            background: linear-gradient(180deg, #ff6b9d 0%, #c44569 100%);
        }

        .finger-btn[data-finger="left-ring"] .finger-visual {
            background: linear-gradient(180deg, #a29bfe 0%, #6c5ce7 100%);
        }

        .finger-btn[data-finger="left-middle"] .finger-visual {
            background: linear-gradient(180deg, #74b9ff 0%, #0984e3 100%);
        }

        .finger-btn[data-finger="left-index"] .finger-visual {
            background: linear-gradient(180deg, #55efc4 0%, #00b894 100%);
        }

        .finger-btn[data-finger="right-index"] .finger-visual {
            background: linear-gradient(180deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #333;
        }

        .finger-btn[data-finger="right-middle"] .finger-visual {
            background: linear-gradient(180deg, #fab1a0 0%, #e17055 100%);
        }

        .finger-btn[data-finger="right-ring"] .finger-visual {
            background: linear-gradient(180deg, #fd79a8 0%, #e84393 100%);
        }

        .finger-btn[data-finger="right-pinky"] .finger-visual {
            background: linear-gradient(180deg, #a29bfe 0%, #6c5ce7 100%);
        }

        .finger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .finger-btn:hover .finger-visual {
            filter: brightness(1.1);
        }

        .finger-btn.active {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
        }

        .finger-btn.active .finger-visual {
            filter: brightness(1.2);
        }

        .finger-btn.active::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border: 2px solid white;
            border-radius: 50%;
            z-index: 10;
        }

        .selected-keys {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            font-size: 1.1em;
        }

        .selected-keys strong {
            color: #2e7d32;
        }

        .practice-area {
            margin-top: 40px;
            padding: 40px 0;
            background: transparent;
            border-radius: 0;
        }

        .practice-area h2 {
            color: #6c757d;
            margin-bottom: 25px;
            font-size: 0.85em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
        }

        .target-text {
            font-size: 2.8em;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Roboto Mono', 'Courier New', monospace;
            margin-bottom: 30px;
            padding: 0;
            padding-right: 10px;
            background: transparent;
            border-radius: 0;
            line-height: 1.8;
            max-height: 25.2em;
            overflow-y: auto;
            overflow-x: hidden;
            letter-spacing: 0.02em;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            text-align: left;
            color: #2d3748;
            font-weight: 400;
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
        }

        .target-text::-webkit-scrollbar {
            width: 6px;
        }

        .target-text::-webkit-scrollbar-track {
            background: transparent;
        }

        .target-text::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .target-text::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .target-text span {
            transition: all 0.15s ease;
        }

        .target-text .correct {
            color: #a0aec0;
            font-weight: 400;
            opacity: 0.5;
        }

        .target-text .error {
            color: #ef4444;
            font-weight: 400;
            background: #fef2f2;
            padding: 0 2px;
            border-radius: 2px;
        }

        .target-text .current {
            background: transparent;
            color: #1a202c;
            font-weight: 500;
            border-bottom: 4px solid #667eea;
            padding: 0 2px;
            border-radius: 0;
            animation: blink-cursor 1.2s ease-in-out infinite;
        }

        /* Space character styling */
        .target-text .space-char {
            color: #cbd5e0;
            font-weight: 300;
            opacity: 0.6;
            font-size: 0.85em;
            display: inline-block;
            position: relative;
            top: 0.05em;
        }

        .target-text .correct.space-char {
            color: #cbd5e0;
            opacity: 0.25;
        }

        .target-text .current.space-char {
            color: #667eea;
            opacity: 1;
            font-weight: 500;
            font-size: 1em;
            top: 0;
        }

        @keyframes blink-cursor {
            0%, 49% { border-bottom-color: #667eea; }
            50%, 100% { border-bottom-color: transparent; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .practice-area {
            cursor: text;
        }

        .input-area {
            position: relative;
        }

        .typing-input {
            position: fixed;
            top: -100px;
            left: -100px;
            opacity: 0;
            pointer-events: none;
            width: 1px;
            height: 1px;
            border: none;
            padding: 0;
        }

        .typing-input:focus {
            outline: none;
        }

        .stats {
            display: flex;
            gap: 24px;
            margin-bottom: 30px;
            padding: 0;
            border: none;
            flex-wrap: wrap;
            align-items: center;
            opacity: 0.7;
        }

        .stat-box {
            padding: 0;
            background: transparent;
            border-radius: 0;
            text-align: left;
            box-shadow: none;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .stat-label {
            color: #718096;
            font-size: 0.75em;
            margin-bottom: 0;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            color: #2d3748;
            font-size: 1em;
            font-weight: 600;
            font-family: 'SF Mono', 'Monaco', monospace;
        }

        .button-group {
            display: flex;
            gap: 8px;
            justify-content: flex-start;
            margin-top: 30px;
            opacity: 0.4;
            transition: opacity 0.3s;
        }

        .button-group:hover {
            opacity: 1;
        }

        .btn-generate, .btn-restart {
            padding: 6px 12px;
            background: transparent;
            color: #667eea;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            box-shadow: none;
        }

        .btn-restart {
            color: #718096;
        }

        .btn-generate:hover {
            background: #f7fafc;
            border-color: #667eea;
            transform: none;
            box-shadow: none;
        }

        .btn-restart:hover {
            background: #f7fafc;
            border-color: #718096;
            transform: none;
            box-shadow: none;
        }

        .btn-generate:disabled, .btn-restart:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .instructions {
            text-align: left;
            color: #cbd5e0;
            margin-top: 12px;
            font-style: normal;
            font-size: 0.7em;
        }

        .shortcuts {
            text-align: left;
            margin-top: 6px;
            padding: 0;
            background: transparent;
            border-radius: 0;
            font-size: 0.7em;
            color: #cbd5e0;
        }

        .shortcuts strong {
            color: #a0aec0;
            font-weight: 500;
        }

        .shortcut-key {
            display: inline-block;
            padding: 2px 4px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 2px;
            font-family: monospace;
            font-weight: normal;
            margin: 0 1px;
            box-shadow: none;
            font-size: 0.85em;
        }

        .settings-panel {
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .settings-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .setting-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Compact Mode Toggle */
        .mode-toggle {
            display: flex;
            background: #dee2e6;
            border-radius: 6px;
            padding: 2px;
            gap: 2px;
        }

        .mode-toggle input[type="radio"] {
            display: none;
        }

        .mode-toggle label {
            padding: 6px 14px;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.2s;
            color: #6c757d;
            user-select: none;
        }

        .mode-toggle input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
        }

        /* Compact Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider {
            width: 100px;
            height: 4px;
            border-radius: 2px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
            font-size: 0.85em;
        }

        /* Compact Radio Buttons */
        .radio-group {
            display: flex;
            gap: 6px;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 6px 12px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            color: #6c757d;
            transition: all 0.2s;
            user-select: none;
        }

        .radio-option input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Compact Toggle Switch */
        .toggle-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dee2e6;
            transition: .2s;
            border-radius: 20px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .2s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #667eea;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .toggle-label {
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
        }

        .progress-bar-container {
            width: 100%;
            height: 2px;
            background: #e9ecef;
            border-radius: 0;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 100%;
            background: #667eea;
            transition: width 0.3s ease;
            border-radius: 0;
        }

        .timer-display {
            font-size: 0.9em;
            font-weight: 500;
            color: #6c757d;
            text-align: left;
            margin-bottom: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .timer-display.warning {
            color: #f39c12;
            animation: none;
        }

        .timer-display.danger {
            color: #e74c3c;
            animation: none;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        /* Focus Mode */
        body.focus-mode h1,
        body.focus-mode .subtitle,
        body.focus-mode .settings-panel,
        body.focus-mode .finger-selector,
        body.focus-mode .keyboard,
        body.focus-mode .selected-keys {
            display: none;
        }

        body.focus-mode .container {
            padding: 20px;
        }

        body.focus-mode .practice-area {
            margin-top: 0;
            padding: 60px 0;
        }

        body.focus-mode .practice-area h2 {
            display: none;
        }

        body.focus-mode .stats {
            margin-bottom: 40px;
        }

        .focus-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .focus-toggle:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-1px);
        }

        body.focus-mode .focus-toggle {
            background: rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .focus-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.05);
            color: #a0aec0;
            border-radius: 4px;
            font-size: 0.7em;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }

        body.focus-mode .focus-hint {
            opacity: 1;
        }

        .focus-hint kbd {
            display: inline-block;
            padding: 2px 6px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <button class="focus-toggle" id="focusToggle">Focus Mode</button>
    <div class="focus-hint">Press <kbd>Esc</kbd> to exit focus mode</div>

    <div class="container">
        <h1>Better Typing</h1>
        <p class="subtitle">Improve your typing skills by practicing specific keys and fingers</p>

        <div class="settings-panel">
            <div class="settings-grid">
                <!-- Mode -->
                <div class="setting-item">
                    <span class="setting-label">Mode:</span>
                    <div class="mode-toggle">
                        <input type="radio" id="modeWords" name="mode" value="words">
                        <label for="modeWords">Words</label>
                        <input type="radio" id="modeTimed" name="mode" value="timed">
                        <label for="modeTimed">Timed</label>
                        <input type="radio" id="modeUnlimited" name="mode" value="unlimited" checked>
                        <label for="modeUnlimited">Unlimited</label>
                    </div>
                </div>

                <!-- Word Count -->
                <div class="setting-item" id="wordCountSetting">
                    <span class="setting-label">Words:</span>
                    <div class="slider-container">
                        <input type="range" min="5" max="50" value="15" class="slider" id="wordCountSlider">
                        <span class="slider-value" id="wordCountValue">15</span>
                    </div>
                </div>

                <!-- Time Limit -->
                <div class="setting-item" id="timeLimitSetting" style="display: none;">
                    <span class="setting-label">Time:</span>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="time30" name="timeLimit" value="30" checked>
                            <label for="time30">30s</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="time60" name="timeLimit" value="60">
                            <label for="time60">60s</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="time120" name="timeLimit" value="120">
                            <label for="time120">2min</label>
                        </div>
                    </div>
                </div>

                <!-- Word Length -->
                <div class="setting-item">
                    <span class="setting-label">Length:</span>
                    <div class="setting-control">
                        <div class="slider-container">
                            <input type="range" min="2" max="12" value="3" class="slider" id="minWordLengthSlider">
                            <span class="slider-value" id="minWordLengthValue">3</span>
                        </div>
                        <span style="color: #adb5bd; font-size: 0.85em;">-</span>
                        <div class="slider-container">
                            <input type="range" min="2" max="12" value="6" class="slider" id="maxWordLengthSlider">
                            <span class="slider-value" id="maxWordLengthValue">6</span>
                        </div>
                    </div>
                </div>

                <!-- Numbers Toggle -->
                <div class="setting-item">
                    <span class="setting-label">Numbers:</span>
                    <div class="toggle-option">
                        <label class="toggle-switch">
                            <input type="checkbox" id="includeNumbers">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Word Set Toggle -->
                <div class="setting-item">
                    <span class="setting-label">Words:</span>
                    <div class="mode-toggle">
                        <input type="radio" id="wordSetGibberish" name="wordSet" value="gibberish">
                        <label for="wordSetGibberish">Gibberish</label>
                        <input type="radio" id="wordSetReal" name="wordSet" value="real" checked>
                        <label for="wordSetReal">Real</label>
                    </div>
                </div>

                <!-- Capitals Toggle -->
                <div class="setting-item">
                    <span class="setting-label">Capitals:</span>
                    <div class="toggle-option">
                        <label class="toggle-switch">
                            <input type="checkbox" id="includeCapitals">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Special Characters Toggle -->
                <div class="setting-item">
                    <span class="setting-label">Special Chars:</span>
                    <div class="toggle-option">
                        <label class="toggle-switch">
                            <input type="checkbox" id="includeSpecialChars">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="finger-selector">
            <div class="finger-buttons">
                <div class="hand-section">
                    <span class="hand-label">Left:</span>
                    <div class="fingers-visual">
                        <button class="finger-btn" data-finger="left-pinky" title="Pinky: 1, Q, A, Z">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="left-ring" title="Ring: 2, W, S, X">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="left-middle" title="Middle: 3, E, D, C">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="left-index" title="Index: 4, 5, R, T, F, G, V, B">
                            <div class="finger-visual"></div>
                        </button>
                    </div>
                </div>
                <div class="hand-section">
                    <span class="hand-label">Right:</span>
                    <div class="fingers-visual">
                        <button class="finger-btn" data-finger="right-index" title="Index: 6, 7, Y, U, H, J, N, M">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="right-middle" title="Middle: 8, I, K, ,">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="right-ring" title="Ring: 9, O, L, .">
                            <div class="finger-visual"></div>
                        </button>
                        <button class="finger-btn" data-finger="right-pinky" title="Pinky: 0, -, =, P, [, ], \, ;, '">
                            <div class="finger-visual"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="keyboard">
            <!-- Number Row -->
            <div class="keyboard-row">
                <div class="key" data-key="`" data-finger="left-pinky"><span class="key-label">~</span><span class="key-main">`</span></div>
                <div class="key" data-key="1" data-finger="left-pinky"><span class="key-label">!</span><span class="key-main">1</span></div>
                <div class="key" data-key="2" data-finger="left-ring"><span class="key-label">@</span><span class="key-main">2</span></div>
                <div class="key" data-key="3" data-finger="left-middle"><span class="key-label">#</span><span class="key-main">3</span></div>
                <div class="key" data-key="4" data-finger="left-index"><span class="key-label">$</span><span class="key-main">4</span></div>
                <div class="key" data-key="5" data-finger="left-index"><span class="key-label">%</span><span class="key-main">5</span></div>
                <div class="key" data-key="6" data-finger="right-index"><span class="key-label">^</span><span class="key-main">6</span></div>
                <div class="key" data-key="7" data-finger="right-index"><span class="key-label">&</span><span class="key-main">7</span></div>
                <div class="key" data-key="8" data-finger="right-middle"><span class="key-label">*</span><span class="key-main">8</span></div>
                <div class="key" data-key="9" data-finger="right-ring"><span class="key-label">(</span><span class="key-main">9</span></div>
                <div class="key" data-key="0" data-finger="right-pinky"><span class="key-label">)</span><span class="key-main">0</span></div>
                <div class="key" data-key="-" data-finger="right-pinky"><span class="key-label">_</span><span class="key-main">-</span></div>
                <div class="key" data-key="=" data-finger="right-pinky"><span class="key-label">+</span><span class="key-main">=</span></div>
                <div class="key backspace" data-key="backspace" data-finger="right-pinky">⌫</div>
            </div>

            <!-- QWERTY Row -->
            <div class="keyboard-row">
                <div class="key tab" data-key="tab" data-finger="left-pinky">Tab</div>
                <div class="key" data-key="q" data-finger="left-pinky">Q</div>
                <div class="key" data-key="w" data-finger="left-ring">W</div>
                <div class="key" data-key="e" data-finger="left-middle">E</div>
                <div class="key" data-key="r" data-finger="left-index">R</div>
                <div class="key" data-key="t" data-finger="left-index">T</div>
                <div class="key" data-key="y" data-finger="right-index">Y</div>
                <div class="key" data-key="u" data-finger="right-index">U</div>
                <div class="key" data-key="i" data-finger="right-middle">I</div>
                <div class="key" data-key="o" data-finger="right-ring">O</div>
                <div class="key" data-key="p" data-finger="right-pinky">P</div>
                <div class="key" data-key="[" data-finger="right-pinky"><span class="key-label">{</span><span class="key-main">[</span></div>
                <div class="key" data-key="]" data-finger="right-pinky"><span class="key-label">}</span><span class="key-main">]</span></div>
                <div class="key" data-key="\" data-finger="right-pinky"><span class="key-label">|</span><span class="key-main">\</span></div>
            </div>

            <!-- ASDF Row (Home Row) -->
            <div class="keyboard-row">
                <div class="key caps" data-key="caps" data-finger="left-pinky">Caps</div>
                <div class="key" data-key="a" data-finger="left-pinky">A</div>
                <div class="key" data-key="s" data-finger="left-ring">S</div>
                <div class="key" data-key="d" data-finger="left-middle">D</div>
                <div class="key home-row" data-key="f" data-finger="left-index">F</div>
                <div class="key" data-key="g" data-finger="left-index">G</div>
                <div class="key" data-key="h" data-finger="right-index">H</div>
                <div class="key home-row" data-key="j" data-finger="right-index">J</div>
                <div class="key" data-key="k" data-finger="right-middle">K</div>
                <div class="key" data-key="l" data-finger="right-ring">L</div>
                <div class="key" data-key=";" data-finger="right-pinky"><span class="key-label">:</span><span class="key-main">;</span></div>
                <div class="key" data-key="'" data-finger="right-pinky"><span class="key-label">"</span><span class="key-main">'</span></div>
                <div class="key enter" data-key="enter" data-finger="right-pinky">Enter</div>
            </div>

            <!-- ZXCV Row -->
            <div class="keyboard-row">
                <div class="key shift-left" data-key="shift" data-finger="left-pinky">Shift</div>
                <div class="key" data-key="z" data-finger="left-pinky">Z</div>
                <div class="key" data-key="x" data-finger="left-ring">X</div>
                <div class="key" data-key="c" data-finger="left-middle">C</div>
                <div class="key" data-key="v" data-finger="left-index">V</div>
                <div class="key" data-key="b" data-finger="left-index">B</div>
                <div class="key" data-key="n" data-finger="right-index">N</div>
                <div class="key" data-key="m" data-finger="right-index">M</div>
                <div class="key" data-key="," data-finger="right-middle"><span class="key-label">&lt;</span><span class="key-main">,</span></div>
                <div class="key" data-key="." data-finger="right-ring"><span class="key-label">&gt;</span><span class="key-main">.</span></div>
                <div class="key" data-key="/" data-finger="right-pinky"><span class="key-label">?</span><span class="key-main">/</span></div>
                <div class="key shift-right" data-key="shift-right" data-finger="right-pinky">Shift</div>
            </div>

            <!-- Space Row -->
            <div class="keyboard-row" style="justify-content: center; margin-left: 0;">
                <div class="key space" data-key=" " style="background: linear-gradient(135deg, #dfe6e9 0%, #b2bec3 100%); border-color: #b2bec3;">SPACE</div>
            </div>
        </div>

        <div class="selected-keys">
            <strong>Selected Keys:</strong> <span id="selectedKeysList">None - Click keys above or use finger shortcuts</span>
        </div>

        <div class="practice-area">
            <h2>Typing Practice</h2>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">WPM</div>
                    <div class="stat-value" id="wpm">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Accuracy</div>
                    <div class="stat-value" id="accuracy">100%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Progress</div>
                    <div class="stat-value" id="progress">0/0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Errors</div>
                    <div class="stat-value" id="errors">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Time</div>
                    <div class="stat-value" id="timeElapsed">0s</div>
                </div>
            </div>

            <div class="timer-display" id="timerDisplay" style="display: none;">
                Time: <span id="timeRemaining">--</span>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
            </div>

            <div class="target-text" id="targetText">
                Select keys above to generate practice text
            </div>
            <div class="input-area">
                <input type="text" class="typing-input" id="typingInput" placeholder="Start typing here..." disabled>
            </div>

            <div class="button-group">
                <button class="btn-restart" id="restartBtn" disabled>Restart Test</button>
                <button class="btn-generate" id="generateBtn" disabled>Generate New Exercise</button>
            </div>
            <p class="instructions">Select keys and start typing! Use buttons or keyboard shortcuts below.</p>
            <div class="shortcuts">
                <strong>Keyboard Shortcuts:</strong>
                <span class="shortcut-key">F</span> Focus Mode •
                <span class="shortcut-key">Shift</span>+<span class="shortcut-key">Enter</span> Restart •
                <span class="shortcut-key">Cmd</span>+<span class="shortcut-key">N</span> New •
                <span class="shortcut-key">Cmd</span>+<span class="shortcut-key">K</span> Focus Input
            </div>
        </div>
    </div>

    <script>
        const fingerMap = {
            'left-pinky': ['`', '1', 'q', 'a', 'z', 'tab', 'caps', 'shift'],
            'left-ring': ['2', 'w', 's', 'x'],
            'left-middle': ['3', 'e', 'd', 'c'],
            'left-index': ['4', '5', 'r', 't', 'f', 'g', 'v', 'b'],
            'right-index': ['6', '7', 'y', 'u', 'h', 'j', 'n', 'm'],
            'right-middle': ['8', 'i', 'k', ','],
            'right-ring': ['9', 'o', 'l', '.'],
            'right-pinky': ['0', '-', '=', 'p', '[', ']', '\\', ';', "'", '/', 'enter', 'backspace', 'shift-right']
        };

        // Top 2000 most common English words (frequency-based, public domain)
        const realWords = [
            'the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'it', 'for', 'not', 'on', 'with', 'he', 'as', 'you', 'do', 'at', 'this',
            'but', 'his', 'by', 'from', 'they', 'we', 'say', 'her', 'she', 'or', 'an', 'will', 'my', 'one', 'all', 'would', 'there', 'their', 'what', 'so',
            'up', 'out', 'if', 'about', 'who', 'get', 'which', 'go', 'me', 'when', 'make', 'can', 'like', 'time', 'no', 'just', 'him', 'know', 'take', 'people',
            'into', 'year', 'your', 'good', 'some', 'could', 'them', 'see', 'other', 'than', 'then', 'now', 'look', 'only', 'come', 'its', 'over', 'think', 'also', 'back',
            'after', 'use', 'two', 'how', 'our', 'work', 'first', 'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'is',
            'was', 'are', 'been', 'has', 'had', 'were', 'said', 'did', 'may', 'should', 'could', 'being', 'does', 'am', 'might', 'must', 'shall', 'having', 'been', 'able',
            'need', 'man', 'find', 'here', 'thing', 'give', 'many', 'well', 'only', 'those', 'tell', 'very', 'even', 'back', 'good', 'woman', 'through', 'us', 'life', 'child',
            'there', 'work', 'down', 'call', 'come', 'still', 'try', 'last', 'ask', 'need', 'too', 'feel', 'three', 'when', 'state', 'never', 'become', 'between', 'high', 'really',
            'something', 'most', 'another', 'much', 'family', 'own', 'leave', 'put', 'old', 'while', 'mean', 'keep', 'student', 'great', 'same', 'big', 'group', 'begin', 'seem', 'country',
            'help', 'talk', 'where', 'turn', 'problem', 'every', 'start', 'hand', 'might', 'show', 'part', 'against', 'place', 'over', 'such', 'again', 'few', 'case', 'week', 'company',
            'where', 'system', 'each', 'right', 'program', 'hear', 'question', 'during', 'work', 'play', 'government', 'run', 'small', 'number', 'off', 'always', 'move', 'night', 'live', 'point',
            'believe', 'hold', 'today', 'bring', 'happen', 'next', 'without', 'before', 'large', 'must', 'home', 'under', 'water', 'room', 'write', 'mother', 'area', 'money', 'story', 'young',
            'fact', 'month', 'different', 'lot', 'study', 'book', 'eye', 'job', 'word', 'though', 'business', 'issue', 'side', 'kind', 'four', 'head', 'far', 'black', 'long', 'both',
            'little', 'house', 'yes', 'since', 'provide', 'service', 'around', 'friend', 'important', 'father', 'sit', 'away', 'until', 'power', 'hour', 'game', 'often', 'yet', 'line', 'political',
            'end', 'among', 'ever', 'stand', 'bad', 'lose', 'however', 'member', 'pay', 'law', 'meet', 'car', 'city', 'almost', 'include', 'continue', 'set', 'later', 'community', 'name',
            'five', 'once', 'white', 'least', 'president', 'learn', 'real', 'change', 'team', 'minute', 'best', 'several', 'idea', 'kid', 'body', 'information', 'nothing', 'ago', 'lead', 'social',
            'understand', 'whether', 'watch', 'together', 'follow', 'around', 'parent', 'only', 'stop', 'face', 'anything', 'create', 'public', 'already', 'speak', 'others', 'read', 'level', 'allow', 'add',
            'office', 'spend', 'door', 'health', 'person', 'art', 'sure', 'war', 'history', 'party', 'within', 'grow', 'result', 'open', 'morning', 'walk', 'reason', 'low', 'win', 'research',
            'girl', 'guy', 'early', 'food', 'moment', 'himself', 'air', 'teacher', 'force', 'offer', 'enough', 'both', 'across', 'although', 'remember', 'foot', 'second', 'boy', 'maybe', 'toward',
            'able', 'age', 'policy', 'everything', 'love', 'process', 'music', 'including', 'consider', 'appear', 'actually', 'buy', 'probably', 'human', 'wait', 'serve', 'market', 'die', 'send', 'expect',
            'sense', 'build', 'stay', 'fall', 'oh', 'nation', 'plan', 'cut', 'college', 'interest', 'death', 'course', 'someone', 'experience', 'behind', 'reach', 'local', 'kill', 'six', 'remain',
            'effect', 'yeah', 'suggest', 'class', 'control', 'raise', 'care', 'perhaps', 'little', 'late', 'hard', 'field', 'else', 'pass', 'former', 'sell', 'major', 'sometimes', 'require', 'along',
            'development', 'themselves', 'report', 'role', 'better', 'economic', 'effort', 'decide', 'rate', 'strong', 'possible', 'heart', 'drug', 'leader', 'light', 'voice', 'wife', 'whole', 'police', 'mind',
            'finally', 'pull', 'return', 'free', 'military', 'price', 'less', 'according', 'decision', 'explain', 'son', 'hope', 'develop', 'view', 'relationship', 'carry', 'town', 'road', 'drive', 'arm',
            'true', 'federal', 'break', 'difference', 'thank', 'receive', 'value', 'international', 'building', 'action', 'full', 'model', 'join', 'season', 'society', 'tax', 'director', 'position', 'player', 'agree',
            'especially', 'record', 'pick', 'wear', 'paper', 'special', 'space', 'ground', 'form', 'support', 'event', 'official', 'whose', 'matter', 'everyone', 'center', 'couple', 'site', 'project', 'hit',
            'base', 'activity', 'star', 'table', 'court', 'produce', 'eat', 'teach', 'half', 'situation', 'easy', 'cost', 'industry', 'figure', 'street', 'image', 'itself', 'phone', 'either', 'data',
            'cover', 'quite', 'picture', 'clear', 'practice', 'piece', 'land', 'recent', 'describe', 'product', 'doctor', 'wall', 'patient', 'worker', 'news', 'test', 'movie', 'certain', 'north', 'simply',
            'third', 'technology', 'catch', 'step', 'baby', 'computer', 'type', 'attention', 'draw', 'film', 'Republican', 'tree', 'source', 'red', 'nearly', 'organization', 'choose', 'cause', 'hair', 'century',
            'evidence', 'window', 'difficult', 'listen', 'soon', 'culture', 'billion', 'chance', 'brother', 'energy', 'period', 'summer', 'realize', 'hundred', 'available', 'plant', 'likely', 'opportunity', 'term', 'short',
            'letter', 'condition', 'choice', 'place', 'single', 'rule', 'daughter', 'administration', 'south', 'husband', 'Congress', 'floor', 'campaign', 'material', 'population', 'economy', 'medical', 'hospital', 'church', 'close',
            'thousand', 'risk', 'current', 'fire', 'future', 'wrong', 'involve', 'defense', 'anyone', 'increase', 'security', 'bank', 'myself', 'certainly', 'west', 'sport', 'board', 'seek', 'per', 'subject',
            'officer', 'private', 'rest', 'behavior', 'deal', 'performance', 'fight', 'throw', 'top', 'quickly', 'past', 'goal', 'bed', 'order', 'author', 'fill', 'represent', 'focus', 'foreign', 'drop',
            'plan', 'blood', 'upon', 'agency', 'push', 'nature', 'color', 'recently', 'store', 'reduce', 'sound', 'note', 'fine', 'near', 'movement', 'page', 'enter', 'share', 'common', 'poor',
            'natural', 'race', 'concern', 'series', 'significant', 'similar', 'hot', 'language', 'each', 'usually', 'response', 'dead', 'rise', 'animal', 'factor', 'decade', 'article', 'shoot', 'east', 'save',
            'seven', 'artist', 'scene', 'stock', 'career', 'despite', 'central', 'eight', 'thus', 'treatment', 'beyond', 'happy', 'exactly', 'protect', 'approach', 'lie', 'size', 'dog', 'fund', 'serious',
            'occur', 'media', 'ready', 'sign', 'thought', 'list', 'individual', 'simple', 'quality', 'pressure', 'accept', 'answer', 'resource', 'identify', 'left', 'meeting', 'determine', 'prepare', 'disease', 'whatever',
            'success', 'argue', 'cup', 'particularly', 'amount', 'ability', 'staff', 'recognize', 'indicate', 'character', 'growth', 'loss', 'degree', 'wonder', 'attack', 'herself', 'region', 'television', 'box', 'TV',
            'training', 'pretty', 'trade', 'election', 'everybody', 'physical', 'lay', 'general', 'feeling', 'standard', 'bill', 'message', 'fail', 'outside', 'arrive', 'analysis', 'benefit', 'sex', 'forward', 'lawyer',
            'present', 'section', 'environmental', 'glass', 'skill', 'sister', 'PM', 'professor', 'operation', 'financial', 'crime', 'stage', 'compare', 'authority', 'miss', 'design', 'sort', 'act', 'ten', 'knowledge',
            'gun', 'station', 'blue', 'strategy', 'clearly', 'discuss', 'indeed', 'truth', 'song', 'example', 'democratic', 'check', 'environment', 'leg', 'dark', 'various', 'rather', 'laugh', 'guess', 'executive',
            'prove', 'hang', 'entire', 'rock', 'forget', 'claim', 'remove', 'manager', 'enjoy', 'network', 'legal', 'religious', 'cold', 'form', 'final', 'main', 'science', 'green', 'memory', 'card',
            'above', 'seat', 'cell', 'establish', 'nice', 'trial', 'expert', 'spring', 'firm', 'Democrat', 'radio', 'visit', 'management', 'avoid', 'imagine', 'tonight', 'huge', 'ball', 'finish', 'yourself',
            'theory', 'impact', 'respond', 'statement', 'maintain', 'charge', 'popular', 'traditional', 'onto', 'reveal', 'direction', 'weapon', 'employee', 'cultural', 'contain', 'peace', 'head', 'control', 'base', 'pain',
            'apply', 'play', 'measure', 'wide', 'shake', 'fly', 'interview', 'manage', 'chair', 'fish', 'particular', 'camera', 'structure', 'politics', 'perform', 'bit', 'weight', 'suddenly', 'discover', 'candidate',
            'production', 'treat', 'trip', 'evening', 'affect', 'inside', 'conference', 'unit', 'best', 'style', 'adult', 'worry', 'range', 'mention', 'rather', 'deep', 'edge', 'specific', 'writer', 'trouble',
            'necessary', 'throughout', 'challenge', 'fear', 'shoulder', 'institution', 'middle', 'sea', 'dream', 'bar', 'beautiful', 'property', 'instead', 'improve', 'stuff', 'claim', 'professor', 'else', 'magazine', 'hotel',
            'soldier', 'reflect', 'heavy', 'sexual', 'bag', 'heat', 'marriage', 'tough', 'sing', 'surface', 'purpose', 'exist', 'pattern', 'whom', 'skin', 'agent', 'owner', 'machine', 'gas', 'ahead',
            'generation', 'commercial', 'address', 'cancer', 'item', 'reality', 'coach', 'Mrs', 'yard', 'beat', 'violence', 'total', 'tend', 'investment', 'discussion', 'finger', 'garden', 'notice', 'collection', 'modern',
            'task', 'partner', 'positive', 'civil', 'kitchen', 'consumer', 'shot', 'budget', 'wish', 'painting', 'scientist', 'safe', 'agreement', 'capital', 'mouth', 'nor', 'victim', 'newspaper', 'threat', 'responsibility',
            'smile', 'attorney', 'score', 'account', 'interesting', 'break', 'audience', 'rich', 'dinner', 'figure', 'vote', 'western', 'relate', 'travel', 'debate', 'prevent', 'citizen', 'majority', 'none', 'front',
            'born', 'admit', 'senior', 'assume', 'wind', 'key', 'professional', 'mission', 'fast', 'alone', 'customer', 'suffer', 'speech', 'successful', 'option', 'participant', 'southern', 'fresh', 'eventually', 'forest',
            'video', 'global', 'reform', 'access', 'restaurant', 'judge', 'publish', 'cost', 'relation', 'like', 'release', 'own', 'bird', 'opinion', 'credit', 'critical', 'corner', 'concerned', 'recall', 'version',
            'stare', 'safety', 'effective', 'neighborhood', 'original', 'act', 'troop', 'income', 'directly', 'hurt', 'species', 'immediately', 'track', 'basic', 'strike', 'hope', 'freedom', 'absolutely', 'plane', 'nobody',
            'achieve', 'object', 'attitude', 'labor', 'refer', 'concept', 'client', 'powerful', 'perfect', 'nine', 'therefore', 'conduct', 'announce', 'conversation', 'examine', 'touch', 'please', 'attend', 'completely', 'vote',
            'variety', 'sleep', 'turn', 'involved', 'investigation', 'nuclear', 'researcher', 'press', 'conflict', 'spirit', 'replace', 'British', 'encourage', 'argument', 'by', 'once', 'camp', 'brain', 'feature', 'afternoon',
            'AM', 'weekend', 'dozen', 'possibility', 'insurance', 'department', 'battle', 'beginning', 'date', 'generally', 'African', 'very', 'sorry', 'crisis', 'complete', 'fan', 'stick', 'define', 'easily', 'through',
            'hole', 'element', 'vision', 'status', 'normal', 'Chinese', 'ship', 'solution', 'stone', 'slowly', 'scale', 'driver', 'attempt', 'park', 'spot', 'lack', 'ice', 'boat', 'drink', 'sun',
            'front', 'distance', 'wood', 'handle', 'truck', 'mountain', 'survey', 'supposed', 'tradition', 'winter', 'village', 'Soviet', 'refuse', 'sales', 'roll', 'communication', 'run', 'screen', 'gain', 'resident',
            'hide', 'gold', 'club', 'farm', 'potential', 'increase', 'middle', 'European', 'presence', 'independent', 'district', 'shape', 'reader', 'Ms', 'contract', 'crowd', 'Christian', 'express', 'apartment', 'willing',
            'strength', 'previous', 'band', 'obviously', 'horse', 'interested', 'target', 'prison', 'ride', 'guard', 'terms', 'demand', 'reporter', 'deliver', 'text', 'tool', 'wild', 'vehicle', 'observe', 'flight',
            'facility', 'understanding', 'average', 'emerge', 'advantage', 'quick', 'light', 'leadership', 'earn', 'pound', 'basis', 'bright', 'operate', 'guest', 'sample', 'contribute', 'tiny', 'block', 'protection', 'settle',
            'feed', 'collect', 'additional', 'while', 'highly', 'identity', 'title', 'mostly', 'lesson', 'faith', 'river', 'promote', 'living', 'count', 'unless', 'marry', 'tomorrow', 'technique', 'path', 'ear',
            'shop', 'folk', 'principle', 'survive', 'lift', 'border', 'competition', 'jump', 'gather', 'limit', 'fit', 'claim', 'cry', 'equipment', 'worth', 'associate', 'critic', 'warm', 'aspect', 'result',
            'insist', 'failure', 'annual', 'French', 'Christmas', 'comment', 'responsible', 'affair', 'procedure', 'regular', 'spread', 'chairman', 'baseball', 'soft', 'ignore', 'egg', 'belief', 'demonstrate', 'anybody', 'murder',
            'gift', 'religion', 'review', 'editor', 'engage', 'coffee', 'document', 'speed', 'cross', 'influence', 'anyway', 'threaten', 'commit', 'female', 'youth', 'wave', 'afraid', 'quarter', 'background', 'native',
            'broad', 'wonderful', 'deny', 'apparently', 'slightly', 'reaction', 'twice', 'suit', 'perspective', 'growing', 'blow', 'construction', 'kind', 'intelligence', 'destroy', 'cook', 'connection', 'burn', 'shoe', 'grade',
            'context', 'committee', 'hey', 'mistake', 'focus', 'smile', 'location', 'clothes', 'Indian', 'quiet', 'dress', 'promise', 'aware', 'neighbor', 'function', 'bone', 'active', 'extend', 'chief', 'combine',
            'wine', 'below', 'cool', 'voter', 'learning', 'bus', 'hell', 'dangerous', 'remind', 'moral', 'United', 'category', 'relatively', 'victory', 'academic', 'Internet', 'healthy', 'negative', 'following', 'historical',
            'medicine', 'tour', 'depend', 'photo', 'finding', 'grab', 'direct', 'classroom', 'contact', 'justice', 'participate', 'daily', 'fair', 'pair', 'famous', 'separate', 'quote', 'German', 'pound', 'double',
            'conversation', 'develop', 'seek', 'connection', 'works', 'brown', 'lead', 'trouble', 'action', 'propose', 'next', 'careful', 'driver', 'conservative', 'present', 'liberal', 'lip', 'launch', 'accurate', 'career',
            'dog', 'scene', 'peace', 'citizen', 'weapon', 'perspective', 'advantage', 'tone', 'ocean', 'signal', 'sentence', 'discipline', 'elsewhere', 'iron', 'perception', 'pack', 'contempor'
        ];

        let selectedKeys = new Set();
        let currentText = '';
        let currentPosition = 0;
        let errorCount = 0;
        let totalTyped = 0;
        let startTime = null;
        let timerInterval = null;
        let timeLimit = 30;
        let isTimedMode = false;
        let isUnlimitedMode = true;

        // Settings
        let wordCount = 15;
        let minWordLength = 3;
        let maxWordLength = 6;
        let includeNumbers = false;
        let useRealWords = true;
        let useCapitals = false;
        let includeSpecialChars = false;

        const keys = document.querySelectorAll('.key');
        const fingerBtns = document.querySelectorAll('.finger-btn');
        const selectedKeysList = document.getElementById('selectedKeysList');
        const generateBtn = document.getElementById('generateBtn');
        const restartBtn = document.getElementById('restartBtn');
        const targetText = document.getElementById('targetText');
        const typingInput = document.getElementById('typingInput');
        const accuracyEl = document.getElementById('accuracy');
        const progressEl = document.getElementById('progress');
        const errorsEl = document.getElementById('errors');
        const wpmEl = document.getElementById('wpm');
        const timeElapsedEl = document.getElementById('timeElapsed');
        const progressBar = document.getElementById('progressBar');
        const timerDisplay = document.getElementById('timerDisplay');
        const timeRemaining = document.getElementById('timeRemaining');

        // Settings elements
        const modeWords = document.getElementById('modeWords');
        const modeTimed = document.getElementById('modeTimed');
        const modeUnlimited = document.getElementById('modeUnlimited');
        const wordCountSetting = document.getElementById('wordCountSetting');
        const timeLimitSetting = document.getElementById('timeLimitSetting');
        const wordCountSlider = document.getElementById('wordCountSlider');
        const wordCountValue = document.getElementById('wordCountValue');
        const minWordLengthSlider = document.getElementById('minWordLengthSlider');
        const minWordLengthValue = document.getElementById('minWordLengthValue');
        const maxWordLengthSlider = document.getElementById('maxWordLengthSlider');
        const maxWordLengthValue = document.getElementById('maxWordLengthValue');
        const minDisplay = document.getElementById('minDisplay');
        const maxDisplay = document.getElementById('maxDisplay');
        const includeNumbersCheckbox = document.getElementById('includeNumbers');
        const wordSetGibberish = document.getElementById('wordSetGibberish');
        const wordSetReal = document.getElementById('wordSetReal');
        const includeCapitalsCheckbox = document.getElementById('includeCapitals');
        const includeSpecialCharsCheckbox = document.getElementById('includeSpecialChars');

        // Handle individual key selection
        keys.forEach(key => {
            key.addEventListener('click', () => {
                const keyValue = key.dataset.key;

                if (selectedKeys.has(keyValue)) {
                    selectedKeys.delete(keyValue);
                    key.classList.remove('selected');
                } else {
                    selectedKeys.add(keyValue);
                    key.classList.add('selected');
                }

                updateSelectedKeysList();
            });
        });

        // Handle finger button selection
        fingerBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const finger = btn.dataset.finger;
                const isActive = btn.classList.contains('active');

                if (isActive) {
                    // Deselect this finger's keys
                    btn.classList.remove('active');
                    fingerMap[finger].forEach(key => {
                        selectedKeys.delete(key);
                        const keyEl = document.querySelector(`.key[data-key="${key}"]`);
                        if (keyEl) keyEl.classList.remove('selected');
                    });
                } else {
                    // Select this finger's keys
                    btn.classList.add('active');
                    fingerMap[finger].forEach(key => {
                        selectedKeys.add(key);
                        const keyEl = document.querySelector(`.key[data-key="${key}"]`);
                        if (keyEl) keyEl.classList.add('selected');
                    });
                }

                updateSelectedKeysList();
            });
        });

        // Settings event listeners
        modeWords.addEventListener('change', () => {
            isTimedMode = false;
            isUnlimitedMode = false;
            wordCountSetting.style.display = 'flex';
            timeLimitSetting.style.display = 'none';
            if (selectedKeys.size > 0) generatePracticeText();
        });

        modeTimed.addEventListener('change', () => {
            isTimedMode = true;
            isUnlimitedMode = false;
            wordCountSetting.style.display = 'none';
            timeLimitSetting.style.display = 'flex';
            const selectedTime = document.querySelector('input[name="timeLimit"]:checked');
            timeLimit = parseInt(selectedTime.value);
            if (selectedKeys.size > 0) generatePracticeText();
        });

        modeUnlimited.addEventListener('change', () => {
            isTimedMode = false;
            isUnlimitedMode = true;
            wordCountSetting.style.display = 'none';
            timeLimitSetting.style.display = 'none';
            if (selectedKeys.size > 0) generatePracticeText();
        });

        document.querySelectorAll('input[name="timeLimit"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                timeLimit = parseInt(e.target.value);
                if (isTimedMode && selectedKeys.size > 0) generatePracticeText();
            });
        });

        wordCountSlider.addEventListener('input', (e) => {
            wordCount = parseInt(e.target.value);
            wordCountValue.textContent = wordCount;
            if (!isTimedMode && selectedKeys.size > 0) generatePracticeText();
        });

        minWordLengthSlider.addEventListener('input', (e) => {
            minWordLength = parseInt(e.target.value);
            if (minWordLength > maxWordLength) {
                maxWordLength = minWordLength;
                maxWordLengthSlider.value = maxWordLength;
                maxWordLengthValue.textContent = maxWordLength;
            }
            minWordLengthValue.textContent = minWordLength;
            minDisplay.textContent = minWordLength;
            maxDisplay.textContent = maxWordLength;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        maxWordLengthSlider.addEventListener('input', (e) => {
            maxWordLength = parseInt(e.target.value);
            if (maxWordLength < minWordLength) {
                minWordLength = maxWordLength;
                minWordLengthSlider.value = minWordLength;
                minWordLengthValue.textContent = minWordLength;
            }
            maxWordLengthValue.textContent = maxWordLength;
            minDisplay.textContent = minWordLength;
            maxDisplay.textContent = maxWordLength;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        includeNumbersCheckbox.addEventListener('change', (e) => {
            includeNumbers = e.target.checked;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        wordSetGibberish.addEventListener('change', () => {
            useRealWords = false;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        wordSetReal.addEventListener('change', () => {
            useRealWords = true;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        includeCapitalsCheckbox.addEventListener('change', (e) => {
            useCapitals = e.target.checked;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        includeSpecialCharsCheckbox.addEventListener('change', (e) => {
            includeSpecialChars = e.target.checked;
            if (selectedKeys.size > 0) generatePracticeText();
        });

        function updateSelectedKeysList() {
            if (selectedKeys.size === 0) {
                selectedKeysList.textContent = 'None - Click keys above or use finger shortcuts';
                generateBtn.disabled = true;
                restartBtn.disabled = true;
                targetText.innerHTML = 'Select keys above to generate practice text';
                typingInput.disabled = true;
                typingInput.value = '';
            } else {
                const nonTypeableKeys = ['tab', 'caps', 'shift', 'shift-right', 'enter', 'backspace'];
                const typeableKeys = Array.from(selectedKeys).filter(k => !nonTypeableKeys.includes(k));
                const keysArray = typeableKeys.map(k => k === ' ' ? 'SPACE' : k.toUpperCase());
                selectedKeysList.textContent = keysArray.length > 0 ? keysArray.join(', ') : 'Only non-typeable keys selected';
                generateBtn.disabled = typeableKeys.length === 0;
                restartBtn.disabled = typeableKeys.length === 0;

                // Auto-generate practice text when keys are selected
                if (typeableKeys.length > 0) {
                    generatePracticeText();
                }
            }
        }

        function restartTest() {
            if (!currentText) return;

            currentPosition = 0;
            errorCount = 0;
            totalTyped = 0;
            startTime = null;

            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            if (isTimedMode) {
                timeRemaining.textContent = timeLimit + 's';
                timerDisplay.classList.remove('warning', 'danger');
            }

            renderText();
            updateStats();

            typingInput.value = '';
            typingInput.disabled = false;
            typingInput.focus();
        }

        function startTimer() {
            if (!isTimedMode) return;

            let elapsed = 0;
            timerInterval = setInterval(() => {
                elapsed++;
                const remaining = timeLimit - elapsed;
                timeRemaining.textContent = remaining + 's';

                if (remaining <= 10 && remaining > 5) {
                    timerDisplay.classList.add('warning');
                    timerDisplay.classList.remove('danger');
                } else if (remaining <= 5) {
                    timerDisplay.classList.add('danger');
                    timerDisplay.classList.remove('warning');
                }

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    endTest();
                }
            }, 1000);
        }

        function endTest() {
            typingInput.disabled = true;
            const finalWPM = calculateWPM();
            const finalAccuracy = totalTyped === 0 ? 100 : Math.round(((totalTyped - errorCount) / totalTyped) * 100);

            setTimeout(() => {
                alert(`Time's up!\n\nWPM: ${finalWPM}\nAccuracy: ${finalAccuracy}%\nErrors: ${errorCount}\n\nClick "Generate New Exercise" to try again!`);
            }, 100);
        }

        function calculateWPM() {
            if (!startTime) return 0;
            const timeElapsed = (Date.now() - startTime) / 1000 / 60; // minutes
            const wordsTyped = currentPosition / 5; // standard: 5 characters = 1 word
            return Math.round(wordsTyped / timeElapsed) || 0;
        }

        function getFilteredKeys() {
            // Filter out non-typeable keys
            const nonTypeableKeys = ['tab', 'caps', 'shift', 'shift-right', 'enter', 'backspace'];
            let keysArray = Array.from(selectedKeys).filter(key => !nonTypeableKeys.includes(key));

            // Filter out numbers if setting is disabled
            if (!includeNumbers) {
                const numberKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
                keysArray = keysArray.filter(key => !numberKeys.includes(key));
            }

            // Filter out special characters if setting is disabled
            if (!includeSpecialChars) {
                const specialChars = ['`', '~', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_', '=', '+', '[', ']', '{', '}', '\\', '|', ';', ':', "'", '"', ',', '<', '.', '>', '/', '?'];
                keysArray = keysArray.filter(key => !specialChars.includes(key));
            }

            return keysArray;
        }

        function getFilteredRealWords(keysArray) {
            // Filter real words to only include words that can be typed with selected keys
            const keySet = new Set(keysArray);
            return realWords.filter(word => {
                // Check if all characters in the word are available in selected keys
                for (let char of word) {
                    if (!keySet.has(char.toLowerCase())) {
                        return false;
                    }
                }
                return true;
            });
        }

        function capitalizeWord(word) {
            if (word.length === 0) return word;
            return word.charAt(0).toUpperCase() + word.slice(1);
        }

        function applyCapitalization(text) {
            if (!useCapitals) return text;

            const words = text.split(' ');
            let wordsSinceCapital = 0;

            for (let i = 0; i < words.length; i++) {
                // Capitalize first word, or randomly every 8-12 words (simulating sentences)
                if (i === 0 || (wordsSinceCapital >= 8 && Math.random() < 0.3)) {
                    words[i] = capitalizeWord(words[i]);
                    wordsSinceCapital = 0;
                } else {
                    wordsSinceCapital++;
                }
            }

            return words.join(' ');
        }

        function generateGibberishText(keysArray, numWords) {
            // Separate letters and special characters
            const specialChars = ['`', '~', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_', '=', '+', '[', ']', '{', '}', '\\', '|', ';', ':', "'", '"', ',', '<', '.', '>', '/', '?'];
            const letters = keysArray.filter(key => !specialChars.includes(key));
            const availableSpecials = keysArray.filter(key => specialChars.includes(key));

            let text = '';
            for (let i = 0; i < numWords; i++) {
                const wordLength = Math.floor(Math.random() * (maxWordLength - minWordLength + 1)) + minWordLength;

                // Generate word primarily from letters
                const useLettersForWord = letters.length > 0;
                const sourceArray = useLettersForWord ? letters : keysArray;

                for (let j = 0; j < wordLength; j++) {
                    const randomKey = sourceArray[Math.floor(Math.random() * sourceArray.length)];
                    text += randomKey;
                }

                // Occasionally add special characters at word boundaries if enabled
                if (includeSpecialChars && availableSpecials.length > 0 && Math.random() < 0.3) {
                    const randomSpecial = availableSpecials[Math.floor(Math.random() * availableSpecials.length)];
                    text += randomSpecial;
                }

                if (i < numWords - 1) text += ' ';
            }
            return applyCapitalization(text);
        }

        function generateRealWordsText(keysArray, numWords) {
            const availableWords = getFilteredRealWords(keysArray);

            if (availableWords.length === 0) {
                // Fall back to gibberish if no real words available
                return generateGibberishText(keysArray, numWords);
            }

            // Get available special characters for punctuation
            const specialChars = ['`', '~', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_', '=', '+', '[', ']', '{', '}', '\\', '|', ';', ':', "'", '"', ',', '<', '.', '>', '/', '?'];
            const availableSpecials = keysArray.filter(key => specialChars.includes(key));
            const punctuation = availableSpecials.filter(char => [',', '.', '!', '?', ';', ':'].includes(char));

            let text = '';
            for (let i = 0; i < numWords; i++) {
                const randomWord = availableWords[Math.floor(Math.random() * availableWords.length)];
                text += randomWord;

                // Add punctuation occasionally if special chars are enabled
                if (includeSpecialChars && punctuation.length > 0 && Math.random() < 0.15) {
                    const randomPunct = punctuation[Math.floor(Math.random() * punctuation.length)];
                    text += randomPunct;
                }

                if (i < numWords - 1) text += ' ';
            }
            return applyCapitalization(text);
        }

        function appendMoreText() {
            // Append more words to the current text for unlimited mode
            const keysArray = getFilteredKeys();
            if (keysArray.length === 0) return;

            const numWords = 50; // Add 50 more words at a time
            let newText = ' '; // Add space before new words

            if (useRealWords) {
                newText += generateRealWordsText(keysArray, numWords);
            } else {
                newText += generateGibberishText(keysArray, numWords);
            }

            currentText += newText;
            renderText();
        }

        function generatePracticeText() {
            if (selectedKeys.size === 0) return;

            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            const keysArray = getFilteredKeys();

            if (keysArray.length === 0) {
                alert('Please select some typeable keys (letters, numbers, symbols)');
                return;
            }

            // Generate more words for timed/unlimited modes
            const numWords = isUnlimitedMode ? 200 : (isTimedMode ? 100 : wordCount);

            let text = '';
            if (useRealWords) {
                text = generateRealWordsText(keysArray, numWords);
            } else {
                text = generateGibberishText(keysArray, numWords);
            }

            currentText = text;
            currentPosition = 0;
            errorCount = 0;
            totalTyped = 0;
            startTime = null;

            // Setup timer display
            if (isTimedMode) {
                timerDisplay.style.display = 'block';
                timeRemaining.textContent = timeLimit + 's';
                timerDisplay.classList.remove('warning', 'danger');
            } else {
                timerDisplay.style.display = 'none';
            }

            renderText();
            updateStats();

            typingInput.value = '';
            typingInput.disabled = false;
        }

        function renderText() {
            let html = '';
            for (let i = 0; i < currentText.length; i++) {
                const char = currentText[i];
                let className = '';

                if (i < currentPosition) {
                    className = 'correct';
                } else if (i === currentPosition) {
                    className = 'current';
                }

                // Add space-char class for spaces
                if (char === ' ') {
                    className += ' space-char';
                }

                html += `<span class="${className}" data-index="${i}">${char === ' ' ? '␣' : char}</span>`;
            }
            targetText.innerHTML = html;

            // Auto-scroll to keep current character visible
            setTimeout(() => {
                const currentSpan = targetText.querySelector('.current');
                if (currentSpan) {
                    const container = targetText;
                    const spanTop = currentSpan.offsetTop;
                    const spanHeight = currentSpan.offsetHeight;
                    const containerHeight = container.clientHeight;
                    const scrollTop = container.scrollTop;

                    // In unlimited mode, keep current line in the top 1/3 of the visible area
                    // This ensures you can always see plenty of upcoming text
                    const targetScrollPosition = spanTop - containerHeight * 0.25;

                    // Scroll if current character is outside the comfortable viewing area
                    if (spanTop < scrollTop + spanHeight ||
                        spanTop > scrollTop + containerHeight * 0.6) {
                        container.scrollTop = Math.max(0, targetScrollPosition);
                    }
                }
            }, 0);
        }

        function updateStats() {
            const accuracy = totalTyped === 0 ? 100 : Math.round(((totalTyped - errorCount) / totalTyped) * 100);
            accuracyEl.textContent = accuracy + '%';
            progressEl.textContent = `${currentPosition}/${currentText.length}`;
            errorsEl.textContent = errorCount;

            // Update WPM
            const wpm = calculateWPM();
            wpmEl.textContent = wpm;

            // Update time elapsed
            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timeElapsedEl.textContent = elapsed + 's';
            } else {
                timeElapsedEl.textContent = '0s';
            }

            // Update progress bar
            const progressPercent = currentText.length > 0 ? (currentPosition / currentText.length) * 100 : 0;
            progressBar.style.width = progressPercent + '%';
        }

        typingInput.addEventListener('input', (e) => {
            const typedValue = e.target.value;
            const typedChar = typedValue[typedValue.length - 1];

            // Start timer on first keystroke
            if (!startTime && typedValue.length === 1) {
                startTime = Date.now();
                if (isTimedMode) {
                    startTimer();
                }
            }

            if (typedValue.length > currentPosition) {
                totalTyped++;

                if (typedChar === currentText[currentPosition]) {
                    currentPosition++;

                    // In unlimited mode, append more text when getting close to the end
                    if (isUnlimitedMode && currentPosition > currentText.length - 100) {
                        appendMoreText();
                    }

                    if (currentPosition === currentText.length) {
                        // Completed!
                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                        }

                        if (isUnlimitedMode) {
                            // Unlimited mode - just append more text
                            appendMoreText();
                        } else if (!isTimedMode) {
                            // Word count mode - auto-generate new exercise
                            setTimeout(() => {
                                generatePracticeText();
                            }, 500);
                        } else {
                            // Timed mode - show completion message
                            typingInput.disabled = true;
                            const finalWPM = calculateWPM();
                            const finalAccuracy = totalTyped === 0 ? 100 : Math.round(((totalTyped - errorCount) / totalTyped) * 100);
                            setTimeout(() => {
                                alert(`Great job!\n\nWPM: ${finalWPM}\nAccuracy: ${finalAccuracy}%\nErrors: ${errorCount}\n\nClick "Generate New Exercise" for another round!`);
                            }, 100);
                        }
                    }
                } else {
                    errorCount++;
                    // Don't advance position on error, let them try again
                    e.target.value = typedValue.slice(0, -1);
                }

                renderText();
                updateStats();
            }
        });

        generateBtn.addEventListener('click', generatePracticeText);
        restartBtn.addEventListener('click', restartTest);

        // Click on target text to focus input and start typing
        targetText.addEventListener('click', () => {
            if (!typingInput.disabled) {
                typingInput.focus();
            }
        });

        // Make the entire practice area focusable - click anywhere to start typing
        document.addEventListener('click', (e) => {
            // Only auto-focus if we have text and input is enabled
            if (currentText && !typingInput.disabled && !e.target.closest('button') && !e.target.closest('input') && !e.target.closest('.key') && !e.target.closest('.finger-btn')) {
                typingInput.focus();
            }
        });

        // Update stats continuously for real-time WPM and time display
        setInterval(() => {
            if (startTime && !typingInput.disabled) {
                updateStats();
            }
        }, 100);

        // Focus Mode
        const focusToggle = document.getElementById('focusToggle');
        let isFocusMode = false;

        function toggleFocusMode() {
            isFocusMode = !isFocusMode;
            document.body.classList.toggle('focus-mode', isFocusMode);
            focusToggle.textContent = isFocusMode ? 'Exit Focus' : 'Focus Mode';
        }

        focusToggle.addEventListener('click', toggleFocusMode);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape - Toggle focus mode
            if (e.key === 'Escape') {
                e.preventDefault();
                if (isFocusMode) {
                    toggleFocusMode();
                }
            }

            // F key - Toggle focus mode
            if (e.key === 'f' && !typingInput.disabled && document.activeElement !== typingInput) {
                e.preventDefault();
                toggleFocusMode();
            }

            // Shift+Enter - Restart test
            if (e.shiftKey && e.key === 'Enter') {
                e.preventDefault();
                if (!restartBtn.disabled) {
                    restartTest();
                }
            }

            // Cmd+N (or Ctrl+N on Windows) - Generate new exercise
            if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
                e.preventDefault();
                if (!generateBtn.disabled) {
                    generatePracticeText();
                }
            }

            // Cmd+K (or Ctrl+K on Windows) - Focus input
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                if (!typingInput.disabled) {
                    typingInput.focus();
                }
            }
        });

        // Prevent backspace in typing input
        typingInput.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace') {
                e.preventDefault();
            }
        });

        // Initialize: Auto-select all fingers on page load
        window.addEventListener('DOMContentLoaded', () => {
            fingerBtns.forEach(btn => {
                const finger = btn.dataset.finger;
                btn.classList.add('active');
                fingerMap[finger].forEach(key => {
                    selectedKeys.add(key);
                    const keyEl = document.querySelector(`.key[data-key="${key}"]`);
                    if (keyEl) keyEl.classList.add('selected');
                });
            });
            updateSelectedKeysList();
        });
    </script>
</body>
</html>